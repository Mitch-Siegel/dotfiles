#include "tests-common.sb"

struct Money {
    u64 dollars;
    u8 cents;
};

impl Money {
    // TODO: pass m2 by value
    public Money fun Add(self, Money *m2) {
        printHex((u64)__out_obj_pointer);
        uart_putc('\n');
        Money added;
        added.cents = self.cents + m2.cents;

        added.dollars = self.dollars + m2.dollars;
        if(added.cents >= 100)
        {
            added.dollars += 1;
            added.cents %= 100;
        }

        return added;        
    }

    public fun SetValue(self, u64 dollars, u8 cents)
    {
        self.dollars = dollars;
        self.cents = cents;
    }

    public fun Print(self)
    {
        printNum((u32)self.dollars);
        uart_putc('.');
        printNum(self.cents);
    }
};

fun main()
{
    Money myBalance;

    myBalance.SetValue(13, 33);
    myBalance.Print();


    Money myPaycheck;
    myPaycheck.SetValue(999, 99);
    myPaycheck.Print();

    Money newBalance = myBalance.Add(&myPaycheck);
    printHex((u64)&newBalance);
    newBalance.Print();

    exit();
}
